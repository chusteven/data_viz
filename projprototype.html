<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>MSAN 622 Information Visualization</title>

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/bootstrap-theme.min.css" rel="stylesheet">

<style type="text/css">
    body {
        padding-top: 50px;
        padding-bottom: 20px;
    }
</style>


</head>

<body>

<!-- this is defining the style for the objects we will have populating our page -->
<style>

/* for parallel coordinates plots */
svg#pp {
  font: 12px sans-serif;
}

svg#pp .background path {
  fill: none;
  stroke: none;
  stroke-width: 20px;
  pointer-events: stroke;
}

svg#pp .foreground path {
  fill: none;
  stroke: steelblue;
  stroke-width: 1.5px;
}

svg#pp .axis .title {
  font-size: 11px;
  font-weight: bold;
  text-transform: uppercase;
}

svg#pp .axis line, .axis path {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

svg#pp .axis.string {
  font-size: 6px;
}

svg#pp .label {
  -webkit-transition: fill 125ms linear;
}

svg#pp .active .label:not(.inactive) {
  font-weight: bold;
  font-size: 11px;
}

svg#pp .label.inactive {
  fill: #ccc;
}

svg#pp .foreground path.inactive {
  stroke: #ccc;
  stroke-opacity: .5;
  stroke-width: 1px;
}






/*for grouped bar plots*/
svg#gbp body {
  font: 10px sans-serif;
}

svg#gbp .axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

svg#gbp .axis text {
    font-family: sans-serif;
    font-size: 10px;
}

svg#gbp .bar {
  fill: steelblue;
}

svg#gbp .x.axis path {
  display: none;
}





/*for small multiples*/
svg#sm body {
  font: 10px sans-serif;
}

svg#sm .axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

svg#sm .axis text {
    font-family: sans-serif;
    font-size: 10px;
}

svg#sm .bar {
  fill: steelblue;
}

svg#sm .x.axis path {
  display: none;
}


</style>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">MSN 622</a>
        </div>

        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li><a href="#homework">Homework</a></li>
                <li><a href="#project">Project</a></li>
                <li><a href="#participation">Participation</a></li>
            </ul>

            <ul class="nav navbar-nav navbar-right">
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">

    <!-- title for homework -->
    <div class="row" style="text-align:center;">
        <h1>Final Project Prototype</h1>
        <p>This page is for Steven Chu's final project prototype. Source code can be found in my <a href="https://github.com/chusteven/spring-2015-msan622/blob/gh-pages/projprototype.html">github respository</a>.</p>
    </div>

</div>

<div class="container">

    <div class="row">

        <div class="media-body" id="userguide">

            <h2 class="page-header">A Brief User Guide</h2>

            <p>A user guide for interactivity here (when it happens).</p>

        </div>

    </div>

</div>

<div class="container">

    <div class="row">

        <h2 class="page-header">Prototypes</h2>

        <p>A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here.</p>

        <h3 class = "page-header">Parallel Coordinates Plot of Depression by Age</h3>
        <div id="parallelcoordinates"></div>

        <p>A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here.</p>

        <h3 class = "page-header">Grouped Bar Chart of Alcohol Abuse by Race and Income</h3>
        <div id="groupedbar"></div>

        <p>A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here.</p>

        <h3 class = "page-header">Small Multiples of Substance Use by Gender</h3>
        <div id="smallmultiples"></div>

        <p>A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here. A bunch of text here.</p>

            <!-- <script type='text/javascript' src='https://public.tableau.com/javascripts/api/viz_v1.js'></script><div class='tableauPlaceholder' style='width: 654px; height: 742px;'><noscript><a href='#'><img alt='Dashboard 1 ' src='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;pr&#47;prototypes&#47;Dashboard1&#47;1_rss.png' style='border: none' /></a></noscript><object class='tableauViz' width='654' height='742' style='display:none;'><param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' /> <param name='site_root' value='' /><param name='name' value='prototypes&#47;Dashboard1' /><param name='tabs' value='no' /><param name='toolbar' value='yes' /><param name='static_image' value='https:&#47;&#47;public.tableau.com&#47;static&#47;images&#47;pr&#47;prototypes&#47;Dashboard1&#47;1.png' /> <param name='animate_transition' value='yes' /><param name='display_static_image' value='yes' /><param name='display_spinner' value='yes' /><param name='display_overlay' value='yes' /><param name='display_count' value='yes' /><param name='showVizHome' value='no' /><param name='showTabs' value='y' /><param name='bootstrapWhenNotified' value='true' /></object></div> -->

        </div>

    </div>

</div>

<div class="container">

    <div class="row">

        <div class="media-body" id="preprocessing">
            
            <h2 class="page-header">Pre-Processing</h1>

            <p>Pre-processing here.</p>

        </div>

    </div>

    <div class="row">

        <div class="media-body" id="discussion">
            
            <h2 class="page-header">Discussion</h1>

            <p>Some kind of discussion over here.</p>

        </div>

    </div>

</div>


<footer>
    <p style="text-align: center;">Steven Chu &bullet; MSAN 622 Information Visualization &bullet; Spring 2015</p>
</footer>

</div>

<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/d3.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.min.js"></script>

<script>

    // for parallel coordinates
    // http://bl.ocks.org/syntagmatic/4020926
    // code from http://bl.ocks.org/syntagmatic/4020926

    // defining margins for this particular graph
    var parallelMargin = {top: 30, right: 40, bottom: 20, left: 100},
        parallelWidth = 1000 - parallelMargin.left - parallelMargin.right,
        parallelHeight = 600 - parallelMargin.top - parallelMargin.bottom;

    // define dimensions that i want to plot
    var dimensions = [
      {
        name: "AGE2",
        // scale: d3.scale.ordinal().rangePoints([0, parallelHeight]),
        // type: "string"
        scale: d3.scale.linear().range([parallelHeight, 0]),
        type: "number"
      },
      {
        name: "avgNervous",
        scale: d3.scale.linear().range([parallelHeight, 0]),
        type: "number"
      },
      {
        name: "avgHopeless",
        scale: d3.scale.linear().range([parallelHeight, 0]),
        type: "number"
      },
      {
        name: "avgRestless",
        scale: d3.scale.linear().range([parallelHeight, 0]),
        type: "number"
      },
      {
        name: "avgSad",
        scale: d3.scale.linear().range([parallelHeight, 0]),
        type: "number"
      },
      {
        name: "avgEffort",
        scale: d3.scale.linear().range([parallelHeight, 0]),
        type: "number"
      },
      {
        name: "avgWorthless",
        scale: d3.scale.linear().range([parallelHeight, 0]),
        type: "number"
      }
    ];

    // defining x axis object
    var xScaleParallel = d3.scale.ordinal()
        .domain(dimensions.map(function(d) { return d.name; }))
        .rangePoints([0, parallelWidth]);

    // creating line function (?)
    var line = d3.svg.line()
        .defined(function(d) { return !isNaN(d[1]); });

    // creating new y axis of sorts - want to know how exactly this interfaces with everything else
    var yAxis2 = d3.svg.axis()
        .orient("left");

    // creating the parallel axes plot
    var parallelChart = d3.select("#parallelcoordinates").append("svg")
        .attr("id", "pp")
        .attr("width", parallelWidth + parallelMargin.left + parallelMargin.right)
        .attr("height", parallelHeight + parallelMargin.top + parallelMargin.bottom)
      .append("g")
        .attr("transform", "translate(" + parallelMargin.left + "," + parallelMargin.top + ")");

    // doing something about the dimensions
    var dimension = parallelChart.selectAll(".dimension")
        .data(dimensions)
      .enter().append("g")
        .attr("class", "dimension")
        .attr("transform", function(d) { return "translate(" + xScaleParallel(d.name) + ")"; });

    // actually reading in the data
    d3.csv("depression.csv", function(data) {
      dimensions.forEach(function(dimension) {
        dimension.scale.domain(
          (dimension.type === "number" && dimension.name === "AGE2")
            ? [7,17]
            : [1,5]
            // data.map(function(d) { return d[dimension.name]; }).sort()
            );
      });

      // what's going on here?
      parallelChart.append("g")
          .attr("class", "background")
        .selectAll("path")
          .data(data)
        .enter().append("path")
          .attr("d", draw);

      // and here?
      parallelChart.append("g")
          .attr("class", "foreground")
        .selectAll("path")
          .data(data)
        .enter().append("path")
          .attr("d", draw);

      // and here?
      dimension.append("g")
          .attr("class", "axis")
          .each(function(d) { d3.select(this).call(yAxis2.scale(d.scale)); })
        .append("text")
          .attr("class", "title")
          .attr("text-anchor", "middle")
          .attr("y", -9)
          .text(function(d) { return d.name; });

      // what is happening here? something about the ordinal labels?
      var ordinal_labels = parallelChart.selectAll(".axis text")
          .on("mouseover", mouseover)
          .on("mouseout", mouseout);

      // some kind of projection thing going on now
      var projection = parallelChart.selectAll(".background path,.foreground path")
          .on("mouseover", mouseover)
          .on("mouseout", mouseout);

      // moseover function
      function mouseover(d) {
        parallelChart.classed("active", true);

        // this could be more elegant (?)
        if (typeof d === "string") {
          projection.classed("inactive", function(p) { return p.name !== d; });
          projection.filter(function(p) { return p.name === d; }).each(moveToFront);
          ordinal_labels.classed("inactive", function(p) { return p !== d; });
          ordinal_labels.filter(function(p) { return p === d; }).each(moveToFront);
        } else {
          projection.classed("inactive", function(p) { return p !== d; });
          projection.filter(function(p) { return p === d; }).each(moveToFront);
          ordinal_labels.classed("inactive", function(p) { return p !== d.name; });
          ordinal_labels.filter(function(p) { return p === d.name; }).each(moveToFront);
        }
      }

      // mouseout function
      function mouseout(d) {
        parallelChart.classed("active", false);
        projection.classed("inactive", false);
        ordinal_labels.classed("inactive", false);
      }

      // what's going on here?
      function moveToFront() {
        this.parentNode.appendChild(this);
      }
    });

    // and here?
    function draw(d) {
      return line(dimensions.map(function(dimension) {
        return [xScaleParallel(dimension.name), dimension.scale(d[dimension.name])];
      }));
    }



    // for grouped bar plot
    // http://bl.ocks.org/mbostock/3887051

    // defining margins for this particular graph
    var gbpmargin = {top: 20, right: 20, bottom: 30, left: 40},
        gbpwidth = 960 - gbpmargin.left - gbpmargin.right,
        gbpheight = 500 - gbpmargin.top - gbpmargin.bottom;

    var gbpx0 = d3.scale.ordinal()
        .rangeRoundBands([0, gbpwidth], .1, .2);

    var gbpx1 = d3.scale.ordinal();

    var gbpy = d3.scale.linear()
        .range([gbpheight, 0]).nice();

    var gbpcolor = d3.scale.ordinal()
        .range(["#98abc5", "#7b6888", "#a05d56", "#ff8c00"]);

    var gbpxAxis = d3.svg.axis()
        .scale(gbpx0)
        .orient("bottom");

    var gbpyAxis = d3.svg.axis()
        .scale(gbpy)
        .orient("left")
        .tickFormat(d3.format(".2s"));

    // entire svg object that the graph lives in
    var gbpsvg = d3.select("#groupedbar").append("svg")
        .attr("id", "gbp")
        .attr("width", gbpwidth + gbpmargin.left + gbpmargin.right)
        .attr("height", gbpheight + gbpmargin.top + gbpmargin.bottom)
      .append("g")
        .attr("transform", "translate(" + gbpmargin.left + "," + gbpmargin.top + ")");

    d3.csv("alcbyincomerace.csv", function(error, data) {
      // var gbpageNames = d3.keys(data[0]).filter(function(key) { return key !== "State"; });
      
      var gbpincomes = d3.keys(data[0]).filter(function(key) { return key !== "Race"; });

      data.forEach(function(d) {
        d.races = gbpincomes.map(function(name) { return {name: name, value: +d[name]}; });
      });

      gbpx0.domain(data.map(function(d) { return d["Race"]; }));
      gbpx1.domain(gbpincomes).rangeRoundBands([0, gbpx0.rangeBand()]);
      gbpy.domain([0, d3.max(data, function(d) { return d3.max(d.races, function(d) { return d.value; }); })]).nice();

      // each group is a set of bars
      gbpsvg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + gbpheight + ")")
          .call(gbpxAxis)

      gbpsvg.append("g")
          .attr("class", "y axis")
          .call(gbpyAxis)
        .append("text")
          .attr("transform", "rotate(-90)")
          .attr("y", 6)
          .attr("dy", ".71em")
          .style("text-anchor", "end")
          .text("average number of days people had an alocholic beverage");

      // this creates all the bars at the same time
      // shifts them accordingly
      var gbpstate = gbpsvg.selectAll(".income")
          .data(data)
        .enter().append("g")
          .attr("class", "g")
          .attr("transform", function(d) { return "translate(" + gbpx0(d["Race"]) + ",0)"; });

      // makes it so that our rectangles are the correct dimensions and shit
      gbpstate.selectAll("rect")
          .data(function(d) { return d.races; })
        .enter().append("rect")
          .attr("width", gbpx1.rangeBand())
          .attr("x", function(d) { return gbpx1(d.name); })
          .attr("y", function(d) { return gbpy(d.value); })
          .attr("height", function(d) { return gbpheight - gbpy(d.value); })
          .style("fill", function(d) { return gbpcolor(d.name); });

      // going to create a new legend per...
      var gbplegend = gbpsvg.selectAll(".legend")
          .data(gbpincomes.slice().reverse())
        .enter().append("g")
          .attr("class", "legend")
          .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

      gbplegend.append("rect")
          .attr("x", gbpwidth - 18)
          .attr("width", 18)
          .attr("height", 18)
          .style("fill", gbpcolor);

      gbplegend.append("text")
          .attr("x", gbpwidth - 24)
          .attr("y", 9)
          .attr("dy", ".35em")
          .style("font-size", "10px")
          .style("text-anchor", "end")
          .text(function(d) { return d; });

    });




    // for small multiples graph
    // http://bl.ocks.org/officeofjane/7315455
    // http://bl.ocks.org/mbostock/3886208

    // defining margins
    var marginsm = {top: 45, right: 100, bottom: 20, left: 30},
        widthsm = 400 - marginsm.left - marginsm.right,
        heightsm = 225 - marginsm.top - marginsm.bottom;

    // this is for each different category i am assuming
    var xsm = d3.scale.ordinal()
        .rangeRoundBands([0, widthsm], .5);

    // Scales. Note the inverted domain for y-scale: bigger is up!
    var ysm = d3.scale.linear()
        .range([heightsm, 0]);

    // want a color per sex (in my situation)
    var colorsm = d3.scale.ordinal()
        .range(["#ff8c00", "#98abc5"]);

    var xAxissm = d3.svg.axis()
        .scale(xsm)
        .orient("bottom");

    var yAxissm = d3.svg.axis()
        .scale(ysm)
        .orient("left")
        .tickFormat(d3.format("s"));

    // csv loaded asynchronously
    d3.csv("substancebygender.csv", function(data) {
      colorsm.domain(["Used", "Not Used"]);

      data.forEach(function(d) {
          // console.log(d);
          var y0 = 0;
          d.used = colorsm.domain().map(function(name) { return {name: name, y0: y0, y1: y0 += +d[name]}; });
          d.total = d.used[d.used.length - 1].y1;
        });

      data.sort(function(a, b) { return b.total - a.total; });

      // Data is nested by country
      var substances = d3.nest()
          .key(function(d) {return d.Substance; })
          .entries(data);

      // Parse dates and numbers. We assume values are sorted by date.
      // Also compute the maximum price per symbol, needed for the y-domain.
      substances.forEach(function(s) {
        s.values.forEach(function(d) { d["Used"] = +d["Used"]; d["Not Used"] = +d["Not Used"]; });
        s.max = d3.max(s.values, function(d) { return d3.max([d["Used"], d["Not Used"]]); });
      });

      // Compute the minimum and maximum year and percent across symbols.
      xsm.domain(data.map(function(d) { return d.Sex; }));
      ysm.domain([0, d3.max(substances, function(s) { return s.max; })]).nice();

      // Add an SVG element for each substance, with the desired dimensions and margin
      // think about how this work with the current html i have going on...
      var svgsm = d3.select("#smallmultiples").selectAll("svg")
        .data(substances)
        .enter()
        .append("svg:svg")
        .attr("id", "sm")
        .attr("width", widthsm + marginsm.left + marginsm.right)
        .attr("height", heightsm + marginsm.top + marginsm.bottom)
      .append("g")
        .attr("transform", "translate(" + marginsm.left + "," + marginsm.top + ")");

      svgsm.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + heightsm + ")")
          .call(xAxissm);

      svgsm.append("g")
          // hide y axis
          .attr("class", "y axis")
          .call(yAxissm)
        .append("text")
        .attr("x", widthsm + 10)
        .attr("y", heightsm/3)
        .attr("dy", ".71em")
        .attr("text-anchor", "start")
        .attr("font-size", "12px")
        .text(function(d) { return d.key});

      // Accessing nested data: https://groups.google.com/forum/#!topic/d3-js/kummm9mS4EA
      // data(function(d) {return d.values;}) 
      // this will dereference the values for nested data for each group
      console.log(substances);

      substance = svgsm.selectAll(".substance")
          .data(function(d) {return d.values})
        .enter().append("g")
          .attr("class", "g")
          .attr("transform", function(d) { return "translate(" + xsm(d.Sex) + ",0)"; });

      substance.selectAll("rect")
          .data(function(d) { return d.used; })
        .enter().append("rect")
          .attr("width", xsm.rangeBand())
          .attr("y", function(d) { return ysm(d.y1); })
          .attr("height", function(d) { return ysm(d.y0) - ysm(d.y1); })
          .style("fill", function(d) { return colorsm(d.name); });

      var legend = svgsm.selectAll(".legend")
          .data(colorsm.domain().slice().reverse())
        .enter().append("g")
          .attr("class", "legend")
          .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

      legend.append("rect")
          .attr("x", widthsm - 18)
          .attr("width", 18)
          .attr("height", 18)
          .style("fill", colorsm);

      legend.append("text")
          .attr("x", widthsm - 24)
          .attr("y", 9)
          .attr("dy", ".35em")
          .style("font-size", "10px")
          .style("text-anchor", "end")
          .text(function(d) { return d; });

    });




</script>